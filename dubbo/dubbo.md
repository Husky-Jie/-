# dubbo：

- Dubbo是 阿里巴巴公司开源的一个高性能RPC 分布式服务框架，使得应用可通过高性能的 RPC 实现服务的输出和输入功能，可以和
  Spring框架无缝集成，现已成为 Apache 基金会孵化项目。

# 集群和分布式

集群：一个业务模块，部署在多台服务器上

分布式：一个大的业务系统，拆分为小的业务模块，分别部署在不同的机器上

# 高级特性:

## 序列化：

dubbo内部已经将序列化和反序列化的过程封装了

我们只需在定义entity类时实现Serializable接口即可，一般会定义一个公共的entity模块，让生产者和消费者都依赖该模块

**controller层的service接口注入使用@Reference注解（远程注入）**



## 地址缓存：

dubbo服务消费者在第一次调用时，会将服务提供者地址缓存到本地，以后在调用则不会访问注册中心。

当服务提供者地址发生变化时，注册中心会通知服务消费者。



## 超时与重试：

### 超时：

服务消费者在调用服务提供者的时候发生了阻塞、等待的情形，这个时候，服务消费者会一直等待下去。
在某个峰值时刻，大量的请求都在同时请求服务消费者，会造成线程的大量堆积，势必会造成雪崩。
dubbo利用超时机制来解决这个问题，设置一个超时时间，在这个时间段内，无法完成服务访问，则自动断开连接。
**使用timeout属性配置超时时间，默认值1000，单位毫秒。**

### 重试：

设置超时时间，在这个时间段内，无法完成服务访问，则自动断开连接。如果出现网络抖动，则这一次请求就会失败。 Dubbo提供重试机制来避免类似问题的发生。**通过retries属性来设置重试次数。默认为2次**



## 多版本：

<img src="D:\Java学习\java笔记\dubbo\image-20221109101821312.png" alt="image-20221109101821312" style="zoom: 50%;" />

<img src="D:\Java学习\java笔记\dubbo\image-20221109101839521.png" alt="image-20221109101839521" style="zoom:50%;" />



灰度发布:当出现新功能时，会让一部分用户先使用新功能，用户反馈没问题时，再将所有用户迁移到新功能。
**dubbo中使用version属性来设置和调用同一个接口的不同版本**



## 负载均衡：

负载均衡策略(4种):

- Random:按权重随机，默认值。按权重设置随机概率。

- RoundRobin:按权重轮询。

- LeastActive:最少活跃调用数，相同活跃数的随机。

- ConsistentHash:一致性Hash，相同参数的请求总是发到同一提供者。

  ```java
  @Reference(loadbalance="random")
  @Reference(loadbalance="roundrobin")
  @Reference(loadbalance="leastactive")
  @Reference(loadbalance="consistenthash")
  ```

  

## 集群容错：

Failfast Cluster
快速失败，只发起一次调用，失败立即报错。通常用于非幂等性的写操作，比如新增记录。

Failsafe Cluster
失败安全，出现异常时，直接忽略。通常用于写入审计日志等操作。

Failback Cluster
失败自动恢复，后台记录失败请求，定时重发。通常用于消息通知操作。

Forking Cluster
并行调用多个服务器，只要一个成功即返回。通常用于实时性要求较高的读操作，但需要浪费更多服务资源。可通过 forks="2" 来设置最大并行数。

Broadcast Cluster
广播调用所有提供者，逐个调用，任意一台报错则报错。通常用于通知所有提供者更新缓存或日志等本地资源信息。



## 服务降级：

服务降级方式:
mock=force:return null表示消费方对该服务的方法调用都直
接返回null 值，不发起远程调用。用来屏蔽不重要服务不可用时对调用方的影响。
mock=fail:return null表示消费方对该服务的方法调用在失败
后，再返回null 值，不抛异常。用来容忍不重要服务不稳定时对调用方的影响。